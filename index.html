<!doctype html>
<!--CKYLINMC-WORKS-->
<html>

<head>
    <title>Loading...</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta name="author" content="CKylinMC" />
    <meta http-equiv="keywords" content="TruthOrDareQuestions">
    <meta http-equiv="description" content="TruthOrDareQuestions site">
    <script>
        (function (window) {
            window.data = {
                curr: "none",
                addr: {
                    zxh: "https://cdn.jsdelivr.net/gh/CKylinMC/TOD_Dict@main/questions.json",
                    dmx: "https://cdn.jsdelivr.net/gh/CKylinMC/TOD_Dict@main/actions.json"
                },
                zxh:{},
                dmx:{},
                include:[],
                exclude:[]
            }
            window.page = {
                loaded: false,
                superTheme: false,
                isIndex: false,
                prevPage: "",
                prevPageBtnAlwaysShow: true,
                startload: new Date().valueOf(),
                endload: new Date().valueOf(),
                loadtiming: 0,
                title: "Document by CKylin",
                url: location.href,
                onload: () => {},
                autoexecs: [],
                callback: (func) => {
                    if (func instanceof Function) {
                        if(page.loaded) func.apply();
                        window.page.autoexecs.push(func);
                    } else console.error(func, "Can not reg as callback: not a function.");
                }
            };
        })(window);
    </script>
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/TODStyles.css">
    <link rel="stylesheet" href="/assets/css/modal.css">
    <link rel="stylesheet" href="/assets/css/PopNotify.css">
    <link rel="stylesheet" href="/assets/css/tips.css">
</head>

<body>
    <header>
        <span class="site-name" onclick="location.href='/'">çœŸå¿ƒè¯å¤§å†’é™© for Online chat</span>
    </header>
    <div class="container loader" id="load-pending">
        <div style="
        font-size: xx-large;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%,-50%);
    ">
            <span class="loading-spinner" style="
            width: 36px;
            height: 36px;
        "> </span>
            <span class="texttip">æ­£åœ¨åŠ è½½...</span>
        </div>
    </div>
    <div class="container hidden" id="content-container">
        <h1>çœŸå¿ƒè¯å¤§å†’é™©</h1>


        <h3>è¾“å…¥å‚ä¸äººåç§°</h3>
        <div class="game-container">
            <ul id="game-names" class="multi-column-menu">
                
            </ul>
            <div class="game-btns">
            <button id="game-reset" onclick="resetGame()" class="red">é‡ç½®</button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button onclick="Game_Go()" id="game-go">â¤ï¸ Go! âš”ï¸</button>
            </div>
            <div class="game-space">&nbsp;</div>
            <div id="game-result" class="hide">&nbsp;</div>
        </div>


        <h3>å¿«é€Ÿç”ŸæˆçœŸå¿ƒè¯é—®é¢˜æˆ–è€…å¤§å†’é™©è¦æ±‚ï¼</h3>

        <ul class="multi-column-menu">
            <li><a href="javascript:void(0)" onclick="zxh()"
                    style="font-size: 1.4rem;font-weight: bold;text-align:center">â¤ï¸ çœŸå¿ƒè¯</a></li>
            <li><a href="javascript:void(0)" onclick="dmx()"
                    style="font-size: 1.4rem;font-weight: bold;text-align:center">âš”ï¸ å¤§å†’é™©</a></li>
        </ul>
    </div>
    <div id="card-container">

    </div>
    <template id="temp-zxh">
        <div class="container hidden" id="card2">
            <h1>â¤ï¸ çœŸå¿ƒè¯</h1>
            <div class="exclude-tags"></div>
            <div class="include-tags"></div>
            <div class="container-btns">
                <button onclick="resetFilter()" class="s-resetfilter s-hide red">é‡ç½®ç­›é€‰</button>
                <button onclick="randomOne()" class="s-random s-hide">ğŸ² éšæœº</button>
            </div>
            <div id="zxh-container" class="s-container">
            </div>
        </div>
    </template>
    <template id="temp-dmx">
        <div class="container hidden" id="card2">
            <h1>âš”ï¸ å¤§å†’é™©</h1>
            <div class="exclude-tags"></div>
            <div class="include-tags"></div>
            <div class="container-btns">
                <button onclick="resetFilter()" class="s-resetfilter s-hide red">é‡ç½®ç­›é€‰</button>
                <button onclick="randomOne()" class="s-random s-hide">ğŸ² éšæœº</button>
            </div>
            <div id="dmx-container" class="s-container">
            </div>
        </div>
    </template>

    <div class="helpbtn" onclick="helpModal()">?</div>

    <div class="top hide" onclick="goTop()">â†‘</div>

    <div class="random-btn" onclick="randomOne()">ğŸ²</div>

    <script>
        page.title = "TruthOrDare Questions";
        // page.url = "/index.html";
        page.isIndex = true;

        page.callback(function () {
            let mode = getUrlParam("mode");
            if (mode) {
                if (mode == "z") {
                    load_zxh();
                    return;
                }
                if (mode == "d") {
                    load_dmx();
                    return;
                }
            }
        });
        

        page.callback(function () {
            loadCard2();
        });
        

        page.callback(function () {
            resetGame();
        });

        window.onscroll = e=>{
            let topbtn = get(".top");
            if(!topbtn) return;
            if(pageYOffset>200){
                if(topbtn.classList.contains("hide"))topbtn.classList.remove("hide");
            }else{
                if(!topbtn.classList.contains("hide"))topbtn.classList.add("hide");
            }
        }

        function goTop(){
            scrollTo({ 
                top: 0, 
                behavior: "smooth" 
            });
        }

        function helpModal(){
            openModal(modalTitle("å…³äºâ€œçœŸå¿ƒè¯å¤§å†’é™©â€")+`
            <h2>ä½¿ç”¨æ–¹æ³•</h2>
            çœŸå¿ƒè¯å¤§å†’é™©ç•Œé¢åˆ†ä¸ºä¸Šä¸‹ä¸¤éƒ¨åˆ†ï¼Œé»˜è®¤åªæ˜¾ç¤ºä¸ŠåŠéƒ¨åˆ†ã€‚ä¸ŠåŠéƒ¨åˆ†ä¸­ï¼Œå¯ä»¥è¾“å…¥å‚ä¸äººå§“åï¼Œè¾“å…¥ä¸¤ä¸ªä»¥ä¸Šå‚ä¸äººåï¼Œå¯ä»¥ç‚¹å‡»â€œGo!â€æŒ‰é’®ï¼Œä¼šè‡ªåŠ¨åœ¨ä¸Šé¢æ‰€è¾“å…¥äººåä¸­é€‰å‡ºèµ¢å®¶å’Œè¾“å®¶ï¼Œå¿«é€Ÿå¼€å±€ã€‚ç‚¹å‡»é‡ç½®å¯ä»¥é‡ç½®æ•´ä¸ªç•Œé¢ï¼ŒåŒ…æ‹¬è¾“å…¥çš„å‚ä¸äººä¹Ÿä¼šè¢«æ¸…ç©ºã€‚<br><br>
            ä¸‹åŠéƒ¨åˆ†é»˜è®¤ä¸æ˜¾ç¤ºï¼Œéœ€è¦ç‚¹å‡»â€œçœŸå¿ƒè¯â€æˆ–è€…â€œå¤§å†’é™©â€æŒ‰é’®é€‰æ‹©è¿›å…¥ä¸€ä¸ªæ¨¡å¼ï¼Œè¿›å…¥åè‡ªåŠ¨è·³è½¬åˆ°å¯¹åº”æ¨¡å¼çš„å¡ç‰‡ï¼Œå°†åˆ—å‡ºæ‰€æœ‰çš„é—®é¢˜æˆ–è¦æ±‚ã€‚ç‚¹å‡»â€œéšæœºâ€å¯ä»¥å¿«é€Ÿéšæœºåˆ°ä¸€ä¸ªå¡ç‰‡ã€‚ç‚¹å‡»å¡ç‰‡çš„æ ‡ç­¾å¯ä»¥é€‰æ‹©å¿…é¡»åŒ…å«è¿™ä¸ªæ ‡ç­¾ï¼Œæˆ–è€…ç¦æ­¢åŒ…å«è¿™ä¸ªæ ‡ç­¾ã€‚å½“é€‰æ‹©ç¦æ­¢åŒ…å«æˆ–å¿…é¡»åŒ…å«åï¼Œåœ¨ä¸‹åŠéƒ¨åˆ†çš„é¡¶éƒ¨ä¼šæ˜¾ç¤ºå·²ç»ç­›é€‰çš„æ¡ä»¶æ ‡ç­¾ï¼Œç‚¹å‡»å³å¯å–æ¶ˆã€‚ç‚¹å‡»é‡ç½®å–æ¶ˆæ‰€æœ‰ç­›é€‰ã€‚<br><br>
            å³ä¸‹è§’æµ®åŠ¨æŒ‰é’®æœ‰â€œå¿«é€Ÿéšæœºâ€å’Œâ€œè¿”å›é¡¶éƒ¨â€ã€‚â€œå¿«é€Ÿéšæœºâ€æŒ‰é’®ä»…ä¼šåœ¨æ˜¾ç¤ºä¸‹åŠéƒ¨åˆ†å¡ç‰‡åæ˜¾ç¤ºï¼Œç‚¹å‡»å³å¯å¿«é€Ÿéšæœºå¡ç‰‡ã€‚â€œè¿”å›é¡¶éƒ¨â€æŒ‰é’®ä»…ä¼šåœ¨æ»šåŠ¨åˆ°éé¡¶éƒ¨åŒºåŸŸæ—¶æ˜¾ç¤ºï¼Œç‚¹å‡»å¯ä»¥å¿«é€Ÿå›åˆ°é¡¶éƒ¨ã€‚
            <br><br>
            <h2>å…³äºâ€œçœŸå¿ƒè¯å¤§å†’é™©â€</h2>
            è¿™æ˜¯ <a href="https://www.ckylin.site">æˆ‘ (CKylinMC)</a> ä½¿ç”¨ä»¥å‰çš„ç»ƒæ‰‹ä½œä¸šæ”¹çš„ä¸€ä¸ªé¡¹ç›®ï¼Œä»£ç ä¸Šä»…ä»…æ˜¯å¯ä»¥è¿è¡Œçš„ç¨‹åº¦ï¼Œä½†æ˜¯æ‰€æœ‰çš„åŠŸèƒ½éƒ½æ˜¯è‡ªå·±å†™çš„ï¼ŒåŒ…æ‹¬é¡µé¢æ ·å¼ã€‚<br><br>
            <b>é¡¹ç›®å¼€æºåœ°å€ï¼š</b><br><a href="https://github.com/ckylinmc/TOD_Web">çœŸå¿ƒè¯å¤§å†’é™© ç½‘é¡µ</a><br><a href="https://github.com/ckylinmc/TOD_Dict">çœŸå¿ƒè¯å¤§å†’é™© è¯­æ–™</a>
            <br><br>
            æ¬¢è¿åé¦ˆæˆ–è´¡çŒ®ï¼
            `);
        }

        function loadCard2(){
            let card2 = get("#card2");
            if (card2) {
                card2.className = "container anim-in delay";
            }
        }

        function zxh() {
            // location.href = "?mode=z";
            load_zxh();
        }

        function dmx() {
            // location.href = "?mode=d";
            load_dmx();
        }

        function load_zxh() {
            window.data.curr = "zxh";
            showTips("â¤ï¸ çœŸå¿ƒè¯");
            let container = get("#card-container");
            if(!container) return;
            let tmpl = get("#temp-zxh");
            if(tmpl){
                container.innerHTML = tmpl.innerHTML;
                loadCard2();
                setTimeout(()=>{
                    scrollTo(0,container.offsetTop-70);
                },200);
                loadList("zxh");
            }
        }

        function load_dmx() {
            window.data.curr = "dmx";
            showTips("âš”ï¸ å¤§å†’é™©");
            let container = get("#card-container");
            if(!container) return;
            let tmpl = get("#temp-dmx");
            if(tmpl){
                container.innerHTML = tmpl.innerHTML;
                loadCard2();
                setTimeout(()=>{
                    scrollTo(0,container.offsetTop-70);
                },200);
                loadList("dmx");
            }
        }

        function loadData_zxh(force = false,callback){
            waitModal();
            if(force||Object.keys(window.data.zxh).length==0){
                CKFetch.get(window.data.addr.zxh+"?v="+Math.random()).then(r=>r.json()).then(
                    json =>{
                        window.data.zxh = json;
                        closeModal();
                        if(callback instanceof Function) callback.apply();
                    }
                );
            }else {
                closeModal();
                if(callback instanceof Function) callback.apply();
            }
        }

        function loadData_dmx(force = false,callback = ()=>{}){
            waitModal();
            if(force||Object.keys(window.data.dmx).length==0){
                CKFetch.get(window.data.addr.dmx+"?v="+Math.random()).then(r=>r.json()).then(
                    json =>{
                        window.data.dmx = json;
                        closeModal();
                        if(callback instanceof Function) callback.apply();
                    }
                );
            }else {
                closeModal();
                if(callback instanceof Function) callback.apply();
            }
        }
        
        function tagsModal(e){
            let t = e.target;
            let tagn = t.innerHTML;
            let modaldom = `
            <button onclick="addExcludeTag('${tagn}')" class="red" style="display:inline-block;margin: 5px auto !important;">æ’é™¤æ­¤æ ‡ç­¾</button>
            <button onclick="addIncludeTag('${tagn}')" class="green" style="display:inline-block;margin: 5px auto !important;">å¿…é¡»åŒ…æ‹¬æ­¤æ ‡ç­¾</button>
            <button onclick="closeModal()" style="display:block;margin: 5px auto !important">å…³é—­</button>
            `;
            openModal(modalTitle("'"+tagn+"'")+modaldom,"center","nobtn");
        }

        function resetFilter(){
            window.data.exclude = [];
            window.data.include = [];
            loadList(window.data.curr);
        }

        function updateTagsDisplay(){
            let ul,arrs;
            if(window.data.exclude.length){
                ul = document.createElement("ul");
                ul.className = "s-tags";
                window.data.exclude.forEach(e=>{
                    let li = document.createElement("li");
                    li.className = "s-tag-item";
                    li.innerHTML = e;
                    li.onclick = ev=>rmExcludeTag(ev.target.innerHTML);
                    ul.appendChild(li);
                });
                arrs = document.querySelectorAll(".exclude-tags");
                arrs.forEach(e=>{
                    e.innerHTML = "<h2>æ’é™¤ï¼š</h2>";
                    e.appendChild(ul);
                });
            }else{
                arrs = document.querySelectorAll(".exclude-tags");
                arrs.forEach(e=>{
                    e.innerHTML = "";
                });
            }
            
            if(window.data.include.length){
                ul = document.createElement("ul");
                ul.className = "s-tags";
                window.data.include.forEach(e=>{
                    let li = document.createElement("li");
                    li.className = "s-tag-item";
                    li.innerHTML = e;
                    li.onclick = ev=>rmIncludeTag(ev.target.innerHTML);
                    ul.appendChild(li);
                });
                arrs = document.querySelectorAll(".include-tags");
                arrs.forEach(e=>{
                    e.innerHTML = "<h2>åŒ…å«ï¼š</h2>";
                    e.appendChild(ul);
                });
            }else{
                arrs = document.querySelectorAll(".include-tags");
                arrs.forEach(e=>{
                    e.innerHTML = "";
                });
            }
        }

        function rmExcludeTag(t){
            console.log(t);
            window.data.exclude.remove(t);
            loadList(window.data.curr);
            closeModal();
        }

        function rmIncludeTag(t){
            window.data.include.remove(t);
            loadList(window.data.curr);
            closeModal();
        }

        function addExcludeTag(t){
            window.data.exclude.push(t);
            loadList(window.data.curr);
            closeModal();
        }

        function addIncludeTag(t){
            window.data.include.push(t);
            loadList(window.data.curr);
            closeModal();
        }

        function randomOne(){
            let container = get("#"+window.data.curr+"-container");
            if(!container) return;
            let arrs = [...container.children];
            if(arrs.length<1) return;
            let newarr = arrs.shuffle();
            let e = document.createEvent("MouseEvents");
            e.initEvent("click",true,true);
            newarr[0].dispatchEvent(e);
            scrollTo({ 
                top: newarr[0].offsetTop+innerHeight/2, 
                behavior: "smooth" 
            });
            showTips("ğŸ² éšæœºæ¨¡å¼");
        }

        function loadList(type){
            let func = ()=>{
                let data = window.data.curr=="zxh"?window.data.zxh:(window.data.curr=="dmx"?window.data.dmx:{});
                if(data=={}) return;
                let items = data.data;
                if(!items) return;
                let container = get("#"+type+"-container");
                if(!container) return;
                container.innerHTML = "";
                let exclude = window.data.exclude;
                let include = window.data.include;
                items.forEach(e=>{
                    let flag = true;
                    exclude.forEach(t=>{
                        if(e.tags.includes(t)){
                            flag = false;
                            return;
                        }
                    });
                    include.forEach(t=>{
                        if(!e.tags.includes(t)){
                            flag = false;
                            return;
                        }
                    });
                    if(!flag)return;
                    container.appendChild(createItem(e.name,e.tags,true));
                    updateTagsDisplay();

                    /* display random btn */
                    let btn = get(".random-btn");
                    let atop = get(".top");
                    let topOffset = 0;
                    if(atop) topOffset = atop.offsetTop-atop.offsetHeight-10;
                    if(btn) {
                        btn.style.top = topOffset + "px";
                        if(!btn.classList.contains("show")) btn.classList.add("show");
                    }
                });
            }
            if(type=="zxh") return loadData_zxh(false,func);
            else return loadData_dmx(false,func);
        }

        function makeTag(name = "-",asdom = false){
            if(asdom) {
                let li = document.createElement("li");
                li.className = "s-tag-item";
                li.innerHTML = name;
                li.onclick = e=>tagsModal(e);
                return li;
            }
            else return `<li class="s-tag-item">{name}</li>`;
        }

        function createItem(title = "@#$%^&*",tags = [],asdom = false) {
            if(asdom){
                let div = document.createElement("div");
                div.onclick = e=>{
                    let flag = true;
                    let targetdom;
                    e.path.forEach(i=>{
                        console.log(i.tagName);
                        if(i.tagName&&i.tagName.toLowerCase()=="li") flag = false;
                        if(i.classList&&i.classList.contains("s-item")) targetdom = i;
                    });
                    if(!flag)return;
                    let allactive = document.querySelectorAll(".s-item-active");
                    [...allactive].forEach(e=>e.classList.remove("s-item-active"));
                    targetdom.classList.add("s-item-active");
                }
                div.setAttribute("data-s-tags",tags.join(","));
                div.className = "s-item";
                let h2 = document.createElement("h2");
                h2.innerHTML = title;
                let ul = document.createElement("ul");
                ul.className = "s-tags";
                tags.forEach(e=>ul.appendChild(makeTag(e,true)));
                div.appendChild(h2);
                div.appendChild(ul);
                return div;
            }else{
                let tagshtml = "";
                tags.forEach(e=>tagshtml += makeTag(e));
                let domhtml = ` <div class="s-item" data-s-tags="%TAGSTR%">
                                    <h2>%TITLE%</h2>
                                    <ul class="s-tags">
                                        %TAGS%
                                    </ul>
                                </div>`;
                domhtml = domhtml.replace("%TITLE%",title).replace("%TAGS%",tagshtml).replace("%TAGSTR%",tags.join(","));
                return domhtml;
            }
        }

        function tip(e, t) {
            let el = e instanceof HTMLElement ? e : e.target;
            let title = "";
            if (el) {
                title = el.innerHTML;
            }
            openModal(modalTitle(title) + t, "success", "å…³é—­æç¤º");
        }
    </script>
    <footer>
        æ¨èåœ¨ç”µè„‘ä¸­ä½¿ç”¨Chromeã€Firefoxæµè§ˆå™¨è®¿é—®<br>
        <a href="https://github.com/CKylinMC/TOD_Web/issues/new/choose">åé¦ˆé¡µé¢bug</a><br>
        <a href="https://github.com/CKylinMC/TOD_Dict/issues/new/choose">æ·»åŠ æ–°çš„è¯æ¡</a><br>
        <span id="busuanzi_container_site_pv">æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡</span><br>
        <a href="https://github.com/CKylinMC/TOD_Web">CKylinMC</a> &copy; 2020
    </footer>
    <script src="/assets/js/Cookies.js"></script>
    <script src="/assets/js/CKFetch.js"></script>
    <script src="/assets/js/PopNotify.js"></script>
    <script src="/assets/js/tips.js"></script>
    <script src="/assets/js/modal.js"></script>
    <script src="/assets/js/common.js"></script>
    <script src="/assets/js/game.js"></script>
    <script src="/assets/js/errorcatcher.js"></script>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <script>
        initModal();
        initTips();
        var tipsShow;
        if (tipsShow = getUrlParam("show")) {
            showTips(tipsShow);
        }
    </script>
    <script>
        (function (window, document) {
            if ("page" in window) {
                let lp = get("#load-pending");
                if (lp) {
                    lp.classList.add("hidden");
                }
                let cc = get("#content-container");
                if (cc) {
                    cc.classList.remove("hidden");
                    cc.classList.add("anim-in");
                }

                if (window.page.onload instanceof Function) {
                    window.page.onload();
                }
                window.page.endload = new Date().valueOf();
                document.title = window.page.title;
                setCurrentPath(window.page.url);
                window.page.loadtiming = (window.page.endload - window.page.startload) / 1000;
                console.info("[LOAD TIME] ç½‘é¡µåŠ è½½è€—æ—¶ " + window.page.loadtiming + " ç§’");

                page.autoexecs.forEach(e => {
                    try {
                        e.apply();
                    } catch (err) {
                        console.error("Errored while executing callback function\n", e,
                            "\n\nThe error is: ", err);
                    }
                });
                page.loaded = true;
            }
        })(window, document);
    </script>
</body>

</html>